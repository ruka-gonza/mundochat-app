<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Título optimizado para búsqueda -->
    <title>MundoChat - Salas de Chat Gratis en Español para Conocer Gente</title>
    
    <!-- Descripción que aparecerá en los resultados de Google -->
    <meta name="description" content="Únete a MundoChat, una comunidad de chat en español. Entra a nuestras salas gratis, conoce gente nueva, haz amigos y diviértete. ¡Registro opcional!">
    
    <!-- Palabras clave (ayudan un poco) -->
    <meta name="keywords" content="chat, chat gratis, chatear, salas de chat, conocer gente, chat en español, mundochat, chat de sexo, chile, españa, mexico, argentina, colombia, venezuela, peru, ecuador, bolivia, uruguay, paraguay, costa rica, cuba, republica dominicana, el salvador, guatemala, honduras, nicaragua, panama, puerto rico">
    
    <link rel="stylesheet" href="style.css">
   <script src="/js/twemoji.min.js"></script>
</head>
<body>

    <!-- PANTALLA DE BIENVENIDA -->
    <div id="welcome-container">
        <div class="welcome-box">
            <h1>Bienvenido a MundoChat</h1>
            <!-- INICIO DEL CONTENIDO AÑADIDO -->
            <p style="margin: 15px 0; color: #555; line-height: 1.5;">
              <!--  Explora nuestras salas de chat en español, conoce gente de todo el mundo, haz nuevos amigos y diviértete en una comunidad segura y moderada. ¡Entra como invitado o regístrate para guardar tu nick! -->
            </p>
            <!-- FIN DEL CONTENIDO AÑADIDO -->
            <div class="auth-tabs">
                <button id="show-guest-tab" class="auth-tab active" data-form="guest-form">Entrar como Invitado</button>
                <button id="show-login-tab" class="auth-tab" data-form="login-form">Entrar como Registrado</button>
                <button id="show-register-tab" class="auth-tab" data-form="register-form">Registrarse</button>
            </div>

            <div id="guest-form" class="auth-form">
                <input type="text" id="guest-nick-input" placeholder="Elige un nick de invitado" maxlength="15">
                <label for="guest-room-select" class="room-label">Elige una sala para entrar:</label>
                <select id="guest-room-select"></select>
                <button id="guest-join-button">Entrar como Invitado</button>
            </div>
            <div id="login-form" class="auth-form hidden">
                <input type="text" id="login-nick-input" placeholder="Tu Nick Registrado" autocomplete="username" maxlength="15">
                <div class="password-container">
                    <input type="password" id="login-password-input" placeholder="Contraseña" autocomplete="current-password">
                    <span id="toggle-password">👁️</span>
                </div>
                <label for="login-room-select" class="room-label">Selecciona una sala:</label>
                <select id="login-room-select"></select>
                <button id="login-button">Entrar al Chat</button>
                <p class="forgot-password-link"><a href="#" id="show-forgot-password">¿Olvidaste tu contraseña?</a></p>
            </div>
            <div id="register-form" class="auth-form hidden">
                <input type="text" id="register-nick-input" placeholder="Elige un Nick (3-15 caracteres)" autocomplete="username" maxlength="15">
                <input type="text" id="register-email-input" placeholder="Tu Correo Electrónico" autocomplete="email">
                <input type="password" id="register-password-input" placeholder="Elige una Contraseña" autocomplete="new-password">
                <input type="password" id="register-password-confirm" placeholder="Confirma la Contraseña" autocomplete="new-password">
                <button id="register-button">Registrar Nick</button>
            </div>
            <p id="auth-error" class="hidden"></p>
            <p id="auth-success" class="hidden"></p>
        </div>
    </div>

    <!-- CONTENEDOR PRINCIPAL DEL CHAT -->
    <div id="chat-container" class="hidden">
        
        <div id="conversations-panel">
            <h3>Conversaciones</h3>
            <div id="conversation-list-container">
                <div class="conversation-group">
                    <h4 class="group-header">Salas</h4>
                    <ul id="room-list"></ul>
                </div>
                <div class="conversation-group">
                    <h4 class="group-header">Mensajes Privados</h4>
                    <ul id="private-chat-list"></ul>
                </div>
            </div>

            <div class="theme-switcher-container">
                <span>Modo Oscuro</span>
                <label class="theme-switcher">
                    <input type="checkbox" id="theme-toggle-checkbox">
                    <span class="slider round"></span>
                </label>
            </div>

            <div id="action-buttons-container">
            </div>
            
            <button id="logout-button" class="action-button-logout">Salir del Chat</button>

        </div>
        
        <div id="chat-area-wrapper">
            <div id="main-chat-area">
                <div id="room-header-container" class="room-header-container">
                    <button id="toggle-conversations-btn" class="mobile-nav-button">
                        ☰
                        <span id="private-unread-badge" class="hidden"></span>
                    </button>
                    <h2 id="room-name-header"></h2>
                    <button id="toggle-users-btn" class="mobile-nav-button">👥</button>

                    <div id="room-switcher" class="room-switcher">
                        <ul id="room-switcher-list"></ul>
                    </div>
                </div>

                <div id="chat-window">
                    <ul id="messages"></ul>
                    <div id="typing-indicator"></div>
                </div>
            </div>

            <div id="private-chat-view" class="hidden">
                <div class="chat-header">
                    <button id="private-chat-back-button" class="mobile-nav-button">&larr;</button>
                    <h2 id="private-chat-with-user"></h2>
                </div>
                <div id="private-chat-window"></div>
                <div id="private-typing-indicator"></div>
            </div>
            
            <form id="form" action="">
                <div id="reply-context-bar" class="hidden">
                    <div class="reply-info">
                        <span class="reply-label">Respondiendo a <strong></strong></span>
                        <p class="reply-text-preview"></p>
                    </div>
                    <button type="button" id="cancel-reply-button" class="cancel-reply-btn">×</button>
                </div>
                
                <input id="input" autocomplete="off" placeholder="Escribe un mensaje..." />
                <button type="button" id="emoji-button" class="chat-action-button">😀</button>
                <label for="image-upload" class="file-label chat-action-button">📷</label>
                <input type="file" id="image-upload" accept="image/*" style="display: none;">
                
                <button type="button" id="record-audio-button" class="chat-action-button">🎤</button>
                <div id="audio-recording-controls" class="hidden">
                    <span id="recording-timer">00:00</span>
                    <button type="button" id="stop-recording-button" class="chat-action-button">⏹️</button>
                    <button type="button" id="send-audio-button" class="chat-action-button hidden">▶️</button>
                    <button type="button" id="cancel-recording-button" class="chat-action-button">✖️</button>
                </div>

                <button type="submit" id="send-icon-button" class="chat-action-button">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(45deg); margin-left: -2px; margin-top: 2px;"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                </button>
                
                <div id="command-suggestions" class="hidden"></div>
                <div id="emoji-picker" class="hidden"></div>
            </form>
            
            
        </div>
        
        <div id="user-list-container">
            <h3>Usuarios (<span id="user-count">0</span>)</h3>
            <div class="user-search-wrapper">
                <input type="text" id="user-search-input" placeholder="Buscar usuario...">
            </div>
            <ul id="user-list"></ul>
        </div>

    </div>
    
    <script src="/socket.io/socket.io.js"></script>
    
     <div id="welcome-popup-overlay" class="modal-overlay hidden">
        <div class="modal-content" id="welcome-popup-content">
            <span class="modal-close-button" id="close-welcome-popup">×</span>
            <div class="popup-body">
                <h2 style="text-align: center;">🌟 ¡Bienvenido a MundoChat! 🌟</h2>
                <p>Has llegado a un espacio pensado para compartir, conversar y pasar un buen momento.</p>
                <p>La regla más importante es el <strong>respeto</strong>. No toleramos faltas de educación, acoso, ni comportamientos ofensivos.</p>
                <p><strong>🌍 Recuerda que estás hablando con personas reales.</strong> Valora las diferencias, sé amable, y usa el chat para construir cosas buenas.</p>
                <p style="text-align: center; font-size: 0.9em; color: #666; margin-top: 20px;"><em>Al hacer clic en "Entendido", activarás las notificaciones de sonido.</em></p>
                <p style="text-align: center; font-weight: bold; margin-top: 10px;">👉 Disfruta del chat y gracias por ser parte de esta comunidad. 💖</p>
                <p>
                <h5 style="text-align: center;">Copyright © -- 2025</h5>
            </div>
            <button class="action-button" id="confirm-welcome-popup" style="margin: 0 auto; display: block; background-color: #1877f2;">¡Entendido!</button>
        </div>
    </div>

    <!-- Admin Agreement Modal -->
    <div id="admin-agreement-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 class="modal-title">ACUERDO DE CONFIDENCIALIDAD</h2>
                        <div id="admin-agreement-text">
                <p><strong>Entre:</strong> Owner (mundochat) y el usuario interesado (nuevo Admin)</p>
                <p>Ambas partes acuerdan lo siguiente:</p>
                <ol>
                    <li>Toda la información compartida entre las partes de manera escrita o por cualquier medio (audio o imágenes), relacionada con el chat o con el resto de usuarios/as de las diferentes salas, será considerada confidencial.</li>
                    <li>No se podrá divulgar, compartir ni utilizar dicha información para fines distintos que no sean los relacionados con el chat.</li>
                    <li>El compromiso de confidencialidad permanecerá vigente mientras dure la actividad de dicho usuario (nuevo Admin) en el chat.</li>
                    <li>En caso de incumplimiento, será cesado de su rol de Admin y expulsado inmediatamente dando por finalizada cualquier relación que tuviera en dicho chat.</li>
                    <li>Y para que quede constancia de la aceptación de dicho contrato, si está de acuerdo, acepte las condiciones más abajo.</li>
                </ol>
            </div>
            <div class="modal-actions">
                <label for="agreement-checkbox">
                    <input type="checkbox" id="agreement-checkbox">
                    He leído y acepto los términos del acuerdo.
                </label>
                <button id="accept-agreement-button" class="action-button" disabled>Aceptar</button>
                <button id="decline-agreement-button" class="action-button">Rechazar</button>
            </div>
        </div>
    </div>

    <!-- MODAL DE RECUPERACIÓN DE CONTRASEÑA -->
    <div id="forgot-password-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <span class="modal-close-button" id="close-forgot-password-modal">×</span>
            <div id="forgot-password-form">
                <h2>Recuperar Contraseña</h2>
                <p>Introduce tu nick o correo electrónico para recibir un enlace de restablecimiento.</p>
                <input type="text" id="forgot-identifier-input" placeholder="Tu Nick o Correo">
                <button id="send-reset-link-button">Enviar Enlace</button>
                <p id="forgot-password-message" class="hidden"></p>
            </div>
        </div>
    </div>
    
    <button id="admin-panel-button" class="hidden">Panel de Admin</button>

    <div id="admin-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <span class="modal-close-button">×</span>
            <h2>Panel de Moderación</h2>
            <div class="admin-tabs">
                <button class="admin-tab active" data-target="banned-users-panel">Baneados</button>
                <button class="admin-tab" data-target="muted-users-panel">Silenciados</button>
                <button class="admin-tab" data-target="reports-panel">Denuncias</button>
                <button class="admin-tab" data-target="activity-monitor-panel">Monitor de Actividad</button>
                <button class="admin-tab" data-target="registered-users-panel">Usuarios Registrados</button>
            </div>

            <div id="banned-users-panel" class="admin-panel">
                <h3>Usuarios Baneados</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ID de Ban</th><th>Nick</th><th>IP</th><th>Baneado por</th><th>Razón</th><th>Fecha</th><th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="banned-users-list"></tbody>
                    </table>
                </div>
            </div>
            <div id="muted-users-panel" class="admin-panel hidden">
                <h3>Usuarios Silenciados</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Usuario</th>
                                <th>Rol</th>
                                <th>VIP</th>
                                <th>Silenciado por</th>
                                <th>Última IP</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="muted-users-list"></tbody>
                    </table>
                </div>
            </div>
            
            <div id="reports-panel" class="admin-panel hidden">
                <h3>Denuncias de Usuarios</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Denunciante</th>
                                <th>Denunciado</th>
                                <th>Razón</th>
                            </tr>
                        </thead>
                        <tbody id="reports-list"></tbody>
                    </table>
                </div>
            </div>
            
            <div id="activity-monitor-panel" class="admin-panel hidden">
                <div class="table-container">
                    <h4>Usuarios Conectados Actualmente</h4>
                    <table>
                        <thead>
                            <tr>
                                <th>Nick</th><th>Rol</th><th>IP</th><th>Salas</th>
                            </tr>
                        </thead>
                        <tbody id="online-users-list"></tbody>
                    </table>
                </div>
                <hr style="margin: 20px 0;">
                <div class="table-container">
                    <h4>Registro de Actividad Reciente (últimos 100)</h4>
                    <table>
                        <thead>
                            <tr>
                                <th>Fecha</th><th>Evento</th><th>Nick</th><th>Rol</th><th>IP</th><th>Detalles</th>
                            </tr>
                        </thead>
                        <tbody id="activity-logs-list"></tbody>
                    </table>
                </div>
            </div>

            <div id="registered-users-panel" class="admin-panel hidden">
                <h3>Usuarios Registrados</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nick</th>
                            </tr>
                        </thead>
                        <tbody id="registered-users-list"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

     <div id="profile-modal" class="modal-overlay hidden">
        <div class="modal-content" id="profile-modal-content">
            <span class="modal-close-button">×</span>
            <h2>Mi Perfil</h2>
            <div class="profile-content">
                <div class="profile-avatar-container">
                    <img id="profile-avatar-preview" src="image/default-avatar.png" alt="Avatar actual" class="profile-avatar">
                    <label for="avatar-file-input" class="avatar-edit-label" title="Cambiar avatar">✏️</label>
                </div>
                
                <p class="profile-nick-display"><strong>Nick actual:</strong> <span id="profile-nick"></span></p>
                
                <div class="profile-section">
                    <label for="new-nick-input">Cambiar Nick</label>
                    <div class="input-group">
                        <input type="text" id="new-nick-input" placeholder="Nuevo Nick (3-15 caracteres)" maxlength="15">
                        <button id="change-nick-button" class="action-button">Cambiar</button>
                    </div>
                </div>

                <div class="profile-section">
                    <label for="avatar-file-input">Cambiar Avatar</label>
                     <input type="file" id="avatar-file-input" class="hidden" accept="image/png, image/jpeg, image/gif, image/webp">
                    <div class="input-group">
                       <label for="avatar-file-input" class="file-input-label">Seleccionar archivo</label>
                       <span id="file-name-display">Ningún archivo seleccionado</span>
                    </div>
                    <button id="save-profile-button" class="action-button primary">Guardar Avatar</button>
                </div>
            </div>
        </div>
    </div>
     <div id="sexo-warning-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2>⚠️ Advertencia</h2>
            <div class="popup-body">
                <p>El acceso a este chat está <strong>prohibido para menores de 18 años.</strong></p>
                <p>No se tolera bajo ninguna circunstancia:</p>
                <ul>
                    <li>Pedofilia</li>
                    <li>Envío o difusión de imágenes o material sexual con menores (CP)</li>
                    <li>Incesto</li>
                    <li>Zoofilia</li>
                    <li>Cualquier contenido ilegal o inapropiado</li>
                </ul>
                <p class="warning-consequence">
                    El incumplimiento de estas reglas resultará en <strong>expulsión inmediata y denuncia a las autoridades.</strong>
                </p>
            </div>
            <button id="accept-sexo-warning" class="action-button">Aceptar y Entrar</button>
        </div>
    </div>
    <div id="avatar-hover-popup" class="hidden">
        <img src="" alt="Avatar a tamaño completo">
    </div>

    <div id="user-action-popup" class="hidden">
        <div class="user-info">
            <strong><span id="popup-user-nick"></span></strong>
            <span id="popup-user-id" class="user-id-display"></span>
        </div>
        <div class="action-buttons">
            <button id="popup-pm-button">Enviar Privado</button>
            <button id="popup-ignore-button">Ignorar</button>
            <button id="popup-report-button">Denunciar</button>
        </div>
        <div id="popup-arrow"></div>
    </div>
    
    <div id="nick-context-menu" class="hidden">
        <button id="context-pm-button">Mensaje Privado</button>
        <button id="context-reply-button">Responder</button>
    </div>

    <div id="self-context-menu" class="hidden">
        <button id="self-afk-button">Ausentar</button>
        <label for="guest-avatar-input" id="self-avatar-label-guest" class="hidden context-menu-button">
            Cambiar Avatar
        </label>
    </div>

     <div id="image-modal-overlay" class="modal-overlay hidden">
        <span id="close-image-modal" class="modal-close-button">&times;</span>
        <img id="modal-image" src="" alt="Vista a tamaño completo">
    </div>
    <div id="mobile-overlay"></div>

    <!-- MODAL DE AYUDA PARA CREADOR DE SALA -->
    <div id="room-creator-help-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <span class="modal-close-button">×</span>
            <h2>¡Felicidades, has creado una sala!</h2>
            <div class="popup-body">
                <p>Como creador de la sala, tienes permisos de <strong>Operador</strong> en ella. Esto te permite mantener el orden y la buena convivencia.</p>
                <p>Estos son los comandos que puedes usar en tu sala:</p>
                <ul>
                    <li><strong>/kick &lt;nick&gt; [razón]</strong> - Expulsa a un usuario de la sala.</li>
                    <li><strong>/mute &lt;nick&gt;</strong> - Silencia o des-silencia a un usuario.</li>
                    <li><strong>/ban &lt;nick&gt; [razón]</strong> - Banea a un usuario (impide su reingreso).</li>
                </ul>
                <p style="margin-top: 15px;">Para ver la lista completa de comandos disponibles para tu rango, escribe <strong>/help</strong> en el chat.</p>
            </div>
        </div>
    </div>

    <input type="file" id="guest-avatar-input" class="hidden" accept="image/png, image/jpeg, image/gif, image/webp">

    <script type="module" src="js/main.js"></script>
</body>
</html>